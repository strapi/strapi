name: 'Publish release'

on:
  workflow_dispatch:
    inputs:
      version:
        type: choice
        description: 'The version you want to publish to NPM'
        options:
          - patch
          - minor
          - prepatch
          - preminor
      distTag:
        type: choice
        description: 'NPM dist-tag'
        default: 'latest'
        options:
          - latest
          - beta
          - rc
          - alpha

jobs:
  publish:
    name: 'Publish (reusable)'
    uses: ./.github/workflows/publish-npm.yml
    if: github.repository == 'strapi/strapi'
    permissions:
      contents: write
      id-token: write
    with:
      tag: ${{ github.event.inputs.distTag }}
      # Pass through the requested bump type (patch/minor/prepatch/etc.) so
      # the publish script can use it as before.
      version: ${{ github.event.inputs.version }}
      type: 'release'
      fetch_depth: 0
